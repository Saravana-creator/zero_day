<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusLink - Polls & Feedback</title>
    <meta name="description" content="Participate in campus polls and provide feedback to improve our community.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/navigation.css">
    <style>
        /* CSS Variables for Design System */
        :root {
            --color-primary-50: #eff6ff;
            --color-primary-100: #dbeafe;
            --color-primary-200: #bfdbfe;
            --color-primary-300: #93c5fd;
            --color-primary-400: #60a5fa;
            --color-primary-500: #3b82f6;
            --color-primary-600: #2563eb;
            --color-primary-700: #1d4ed8;
            --color-primary-800: #1e40af;
            --color-primary-900: #1e3a8a;
            
            --color-secondary-50: #f8fafc;
            --color-secondary-100: #f1f5f9;
            --color-secondary-200: #e2e8f0;
            --color-secondary-300: #cbd5e1;
            --color-secondary-400: #94a3b8;
            --color-secondary-500: #64748b;
            --color-secondary-600: #475569;
            --color-secondary-700: #334155;
            --color-secondary-800: #1e293b;
            --color-secondary-900: #0f172a;
            
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-hero: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
        }

        /* Global Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(to bottom right, var(--color-secondary-50), var(--color-primary-50));
            color: var(--color-secondary-900);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.2;
        }

        h1 { font-size: 3rem; }
        h2 { font-size: 2.5rem; }
        h3 { font-size: 2rem; }
        h4 { font-size: 1.5rem; }

        /* Utility Classes */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .text-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--radius-xl);
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary-600);
            border: 2px solid var(--color-primary-600);
        }

        .btn-secondary:hover {
            background: var(--color-primary-600);
            color: white;
        }

        .btn-ghost {
            background: transparent;
            color: var(--color-secondary-600);
            border: 1px solid var(--color-secondary-300);
        }

        .btn-ghost:hover {
            background: var(--color-primary-50);
            color: var(--color-primary-600);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .card {
            background: white;
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--color-secondary-200);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            text-decoration: none;
        }

        .nav-brand .logo {
            font-size: 2rem;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--color-secondary-600);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--color-primary-600);
            background: var(--color-primary-50);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-secondary-600);
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-hero);
            color: white;
            padding: 8rem 0 4rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' fill-rule='evenodd'%3e%3cg fill='%23ffffff' fill-opacity='0.05'%3e%3ccircle cx='30' cy='30' r='1'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e");
            opacity: 0.5;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Sections */
        .section {
            padding: 5rem 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header h2 {
            margin-bottom: 1rem;
        }

        .section-header p {
            font-size: 1.125rem;
            color: var(--color-secondary-600);
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-container">
                <a href="campuslink.html" class="nav-brand">
                    <span class="logo">🎓</span>
                    <span class="text-gradient">CampusLink</span>
                </a>
                
                <ul class="nav-menu" id="navMenu">
                    <li><a href="campuslink.html" class="nav-link">Home</a></li>
                    <li><a href="campuslink.html#about" class="nav-link">About</a></li>
                    <li><a href="campuslink.html#skills" class="nav-link">Skills</a></li>
                    <li><a href="polls.html" class="nav-link active">Polls</a></li>
                    <li><a href="campuslink.html#contact" class="nav-link">Contact</a></li>
                </ul>
                
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    ☰
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>
                    <span class="text-gradient">Polls & Feedback</span>
                </h1>
                <p>Share your opinions, participate in campus decisions, and help improve our community together.</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="section">
        <div class="container">
            <!-- Role Toggle -->
            <div style="text-align: center; margin-bottom: 3rem;">
                <div style="display: inline-flex; background: white; border-radius: var(--radius-xl); padding: 0.5rem; box-shadow: var(--shadow-md);">
                    <button class="btn btn-primary" onclick="setUserRole('student')" id="studentRoleBtn">👨‍🎓 Student View</button>
                    <button class="btn btn-ghost" onclick="setUserRole('admin')" id="adminRoleBtn">👨‍💼 Admin View</button>
                </div>
            </div>

            <!-- User Info Panel -->
            <div id="userInfoPanel" class="card" style="margin-bottom: 3rem; padding: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 id="userRoleTitle">Student Dashboard</h4>
                        <p id="userRoleDescription" style="color: var(--color-secondary-600); margin-top: 0.5rem;">
                            Participate in polls and share your feedback to help improve campus life.
                        </p>
                    </div>
                    <div id="userStats" style="text-align: right;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--color-primary-600);" id="statsNumber">5</div>
                        <div style="font-size: 0.875rem; color: var(--color-secondary-600);" id="statsLabel">Polls Participated</div>
                    </div>
                </div>
            </div>

            <!-- Admin Controls -->
            <div id="adminControls" style="display: none; margin-bottom: 3rem;">
                <div class="card" style="padding: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h3>Poll Management</h3>
                            <p style="color: var(--color-secondary-600); margin-top: 0.5rem;">Create, manage, and analyze campus polls</p>
                        </div>
                        <button class="btn btn-primary" onclick="showCreatePollModal()">➕ Create New Poll</button>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div style="text-align: center; padding: 1.5rem; background: var(--color-primary-50); border-radius: var(--radius-lg);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">📊</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary-600);" id="totalPolls">8</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Total Polls</div>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: var(--color-secondary-50); border-radius: var(--radius-lg);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">✅</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-secondary-600);" id="activePolls">5</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Active Polls</div>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: #f0fdf4; border-radius: var(--radius-lg);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">🗳️</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #059669;" id="totalVotes">342</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Total Votes</div>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: #fef3c7; border-radius: var(--radius-lg);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">👥</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #d97706;" id="participationRate">68%</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Participation</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter and Search -->
            <div style="margin-bottom: 3rem;">
                <div class="card" style="padding: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 1rem; align-items: center;">
                        <div>
                            <input type="text" id="searchPolls" placeholder="Search polls..."
                                   style="width: 100%; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;"
                                   onkeyup="filterPolls()">
                        </div>
                        <div>
                            <select id="categoryFilter" onchange="filterPolls()"
                                    style="padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                                <option value="">All Categories</option>
                                <option value="general">General</option>
                                <option value="academics">Academics</option>
                                <option value="facilities">Facilities</option>
                                <option value="events">Events</option>
                                <option value="feedback">Feedback</option>
                            </select>
                        </div>
                        <div>
                            <select id="statusFilter" onchange="filterPolls()"
                                    style="padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Polls Container -->
            <div id="pollsContainer">
                <!-- Polls will be populated by JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="emptyPolls" style="display: none;">
                <div class="card" style="text-align: center; padding: 4rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">🗳️</div>
                    <h3 style="margin-bottom: 1rem;">No Polls Found</h3>
                    <p style="color: var(--color-secondary-600);">Try adjusting your filters or check back later for new polls.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Poll Modal -->
    <div id="createPollModal" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3>Create New Poll</h3>
                <button onclick="hideCreatePollModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--color-secondary-600);">✕</button>
            </div>

            <form id="createPollForm">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Poll Question</label>
                    <input type="text" id="pollQuestion" required placeholder="Enter your poll question..."
                           style="width: 100%; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description (Optional)</label>
                    <textarea id="pollDescription" rows="3" placeholder="Add more context to your poll..."
                              style="width: 100%; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem; resize: vertical;"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Category</label>
                        <select id="pollCategory" required style="width: 100%; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                            <option value="">Select Category</option>
                            <option value="general">General</option>
                            <option value="academics">Academics</option>
                            <option value="facilities">Facilities</option>
                            <option value="events">Events</option>
                            <option value="feedback">Feedback</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Duration</label>
                        <select id="pollDuration" required style="width: 100%; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                            <option value="">Select Duration</option>
                            <option value="1">1 Day</option>
                            <option value="3">3 Days</option>
                            <option value="7">1 Week</option>
                            <option value="14">2 Weeks</option>
                            <option value="30">1 Month</option>
                        </select>
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Poll Options</label>
                    <div id="pollOptions">
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="text" class="poll-option-input" required placeholder="Option 1"
                                   style="flex: 1; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                            <button type="button" onclick="removePollOption(this)" class="btn btn-danger" style="padding: 0.75rem;">🗑️</button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="text" class="poll-option-input" required placeholder="Option 2"
                                   style="flex: 1; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                            <button type="button" onclick="removePollOption(this)" class="btn btn-danger" style="padding: 0.75rem;">🗑️</button>
                        </div>
                    </div>
                    <button type="button" onclick="addPollOption()" class="btn btn-ghost" style="margin-top: 0.5rem;">+ Add Option</button>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="allowMultiple" style="width: 1.25rem; height: 1.25rem;">
                        <span>Allow multiple selections</span>
                    </label>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Create Poll</button>
                    <button type="button" onclick="hideCreatePollModal()" class="btn btn-ghost" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Poll Details Modal -->
    <div id="pollDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3>Poll Details & Analytics</h3>
                <button onclick="hidePollDetailsModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--color-secondary-600);">✕</button>
            </div>
            <div id="pollDetailsContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal Styles -->
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-2xl);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.info {
            background: var(--color-primary-600);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: var(--shadow-lg);
                border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            }

            .nav-menu.active {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .container {
                padding: 0 1rem;
            }

            .section {
                padding: 3rem 0;
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 6rem 0 3rem;
            }

            .hero h1 {
                font-size: 2rem;
            }
        }
    </style>

    <script>
        // Global Variables
        let currentUserRole = 'student';
        let filteredPolls = [];

        // Sample Data - Enhanced with more details
        let polls = [
            {
                id: 1,
                question: "Should the university extend library hours during exam periods?",
                description: "Many students have requested longer library access during finals week. This poll will help determine if there's enough demand to justify the additional staffing costs.",
                options: ["Yes, extend to 2 AM", "Yes, extend to midnight", "Current hours are fine", "Reduce hours to save costs"],
                votes: [85, 45, 32, 8],
                totalVotes: 170,
                category: "facilities",
                createdBy: "Admin",
                createdAt: "2025-01-20",
                expiresAt: "2025-01-27",
                isActive: true,
                hasVoted: false,
                allowMultiple: false,
                userVote: null
            },
            {
                id: 2,
                question: "Which programming language should be added to the CS curriculum?",
                description: "The Computer Science department is looking to add a new programming language course. Your input will help shape the curriculum for next semester.",
                options: ["Rust", "Go", "Kotlin", "Swift", "TypeScript"],
                votes: [34, 28, 22, 15, 41],
                totalVotes: 140,
                category: "academics",
                createdBy: "CS Department",
                createdAt: "2025-01-18",
                expiresAt: "2025-01-25",
                isActive: true,
                hasVoted: true,
                allowMultiple: false,
                userVote: 4
            },
            {
                id: 3,
                question: "How would you rate the recent Career Fair event?",
                description: "Your feedback helps us improve future career events and better serve student needs.",
                options: ["Excellent", "Good", "Average", "Poor", "Didn't attend"],
                votes: [45, 38, 22, 8, 15],
                totalVotes: 128,
                category: "events",
                createdBy: "Career Services",
                createdAt: "2025-01-15",
                expiresAt: "2025-01-22",
                isActive: false,
                hasVoted: true,
                allowMultiple: false,
                userVote: 0
            },
            {
                id: 4,
                question: "What new food options would you like in the cafeteria?",
                description: "Help us diversify our dining options based on student preferences and dietary needs.",
                options: ["More vegetarian options", "International cuisine", "Healthy snacks", "Late-night options", "Local food vendors"],
                votes: [67, 89, 45, 78, 34],
                totalVotes: 313,
                category: "facilities",
                createdBy: "Dining Services",
                createdAt: "2025-01-12",
                expiresAt: "2025-01-19",
                isActive: true,
                hasVoted: false,
                allowMultiple: true,
                userVote: null
            },
            {
                id: 5,
                question: "Should the university implement a mental health day policy?",
                description: "Proposal to allow students to take designated mental health days without academic penalty.",
                options: ["Yes, 2 days per semester", "Yes, 1 day per semester", "Yes, but with restrictions", "No, current policies are sufficient"],
                votes: [95, 42, 28, 15],
                totalVotes: 180,
                category: "general",
                createdBy: "Student Wellness",
                createdAt: "2025-01-10",
                expiresAt: "2025-01-24",
                isActive: true,
                hasVoted: true,
                allowMultiple: false,
                userVote: 0
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setUserRole('student');
            renderPolls();
            updateStats();
        });

        // Navigation Functions
        function toggleMobileMenu() {
            document.getElementById('navMenu').classList.toggle('active');
        }

        // Role Management
        function setUserRole(role) {
            currentUserRole = role;
            const studentBtn = document.getElementById('studentRoleBtn');
            const adminBtn = document.getElementById('adminRoleBtn');
            const adminControls = document.getElementById('adminControls');
            const userInfoPanel = document.getElementById('userInfoPanel');
            const userRoleTitle = document.getElementById('userRoleTitle');
            const userRoleDescription = document.getElementById('userRoleDescription');
            const statsNumber = document.getElementById('statsNumber');
            const statsLabel = document.getElementById('statsLabel');

            if (role === 'student') {
                studentBtn.className = 'btn btn-primary';
                adminBtn.className = 'btn btn-ghost';
                adminControls.style.display = 'none';
                userRoleTitle.textContent = 'Student Dashboard';
                userRoleDescription.textContent = 'Participate in polls and share your feedback to help improve campus life.';
                statsNumber.textContent = polls.filter(p => p.hasVoted).length;
                statsLabel.textContent = 'Polls Participated';
            } else {
                studentBtn.className = 'btn btn-ghost';
                adminBtn.className = 'btn btn-primary';
                adminControls.style.display = 'block';
                userRoleTitle.textContent = 'Admin Dashboard';
                userRoleDescription.textContent = 'Create and manage polls, view analytics, and engage with the campus community.';
                statsNumber.textContent = polls.length;
                statsLabel.textContent = 'Total Polls Created';
            }

            renderPolls();
            updateStats();
        }

        // Statistics Update
        function updateStats() {
            if (currentUserRole === 'admin') {
                document.getElementById('totalPolls').textContent = polls.length;
                document.getElementById('activePolls').textContent = polls.filter(p => p.isActive).length;
                document.getElementById('totalVotes').textContent = polls.reduce((sum, poll) => sum + poll.totalVotes, 0);

                const totalPossibleVotes = polls.length * 200; // Assuming 200 potential voters
                const actualVotes = polls.reduce((sum, poll) => sum + poll.totalVotes, 0);
                const participationRate = Math.round((actualVotes / totalPossibleVotes) * 100);
                document.getElementById('participationRate').textContent = participationRate + '%';
            }
        }

        // Filter Functions
        function filterPolls() {
            const searchTerm = document.getElementById('searchPolls').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredPolls = polls.filter(poll => {
                const matchesSearch = poll.question.toLowerCase().includes(searchTerm) ||
                                    poll.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || poll.category === categoryFilter;
                const matchesStatus = !statusFilter ||
                                    (statusFilter === 'active' && poll.isActive) ||
                                    (statusFilter === 'closed' && !poll.isActive);
                const matchesRole = currentUserRole === 'admin' || poll.isActive;

                return matchesSearch && matchesCategory && matchesStatus && matchesRole;
            });

            renderPolls();
        }

        // Poll Rendering
        function renderPolls() {
            const container = document.getElementById('pollsContainer');
            const emptyState = document.getElementById('emptyPolls');

            if (!container) return;

            // Use filtered polls if filters are applied, otherwise show all relevant polls
            const pollsToShow = filteredPolls.length > 0 || hasActiveFilters() ?
                               filteredPolls :
                               polls.filter(poll => currentUserRole === 'admin' || poll.isActive);

            if (pollsToShow.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'block';
            emptyState.style.display = 'none';

            container.innerHTML = pollsToShow.map(poll => renderPollCard(poll)).join('');
        }

        function hasActiveFilters() {
            const searchTerm = document.getElementById('searchPolls').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            return searchTerm || categoryFilter || statusFilter;
        }

        function renderPollCard(poll) {
            const categoryIcons = {
                academics: "📚",
                facilities: "🏢",
                events: "🎉",
                general: "💬",
                feedback: "📝"
            };

            const categoryColors = {
                academics: "background: #dbeafe; color: #1e40af;",
                facilities: "background: #dcfce7; color: #166534;",
                events: "background: #f3e8ff; color: #7c3aed;",
                general: "background: #f1f5f9; color: #475569;",
                feedback: "background: #fed7aa; color: #ea580c;"
            };

            const isExpired = new Date(poll.expiresAt) < new Date();
            const daysLeft = Math.ceil((new Date(poll.expiresAt) - new Date()) / (1000 * 60 * 60 * 24));

            return `
                <div class="card" style="margin-bottom: 2rem; padding: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="font-size: 2rem;">${categoryIcons[poll.category] || "💬"}</span>
                                <span style="padding: 0.25rem 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 500; ${categoryColors[poll.category] || categoryColors.general}">
                                    ${poll.category.charAt(0).toUpperCase() + poll.category.slice(1)}
                                </span>
                                ${!poll.isActive ? '<span style="padding: 0.25rem 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 500; background: #fee2e2; color: #991b1b;">Closed</span>' : ''}
                                ${poll.isActive && daysLeft <= 1 ? '<span style="padding: 0.25rem 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 500; background: #fef3c7; color: #d97706;">Ending Soon</span>' : ''}
                            </div>
                            <h3 style="margin-bottom: 0.5rem; color: var(--color-secondary-800);">${poll.question}</h3>
                            ${poll.description ? `<p style="color: var(--color-secondary-600); margin-bottom: 1rem; font-size: 0.95rem;">${poll.description}</p>` : ''}
                            <p style="font-size: 0.875rem; color: var(--color-secondary-500);">
                                Created by ${poll.createdBy} • ${poll.createdAt} • ${poll.totalVotes} votes
                                ${poll.isActive ? ` • ${daysLeft > 0 ? daysLeft + ' days left' : 'Expires today'}` : ''}
                            </p>
                        </div>
                        ${currentUserRole === 'admin' ? `
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="showPollDetails(${poll.id})" class="btn btn-ghost" style="padding: 0.5rem;">📊</button>
                                <button onclick="togglePollStatus(${poll.id})" class="btn ${poll.isActive ? 'btn-danger' : 'btn-success'}" style="padding: 0.5rem;">
                                    ${poll.isActive ? '⏸️' : '▶️'}
                                </button>
                                <button onclick="deletePoll(${poll.id})" class="btn btn-danger" style="padding: 0.5rem;">🗑️</button>
                            </div>
                        ` : ''}
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        ${poll.options.map((option, index) => {
                            const percentage = poll.totalVotes > 0 ? Math.round((poll.votes[index] / poll.totalVotes) * 100) : 0;
                            const isUserVote = poll.hasVoted && (poll.allowMultiple ? poll.userVote?.includes(index) : poll.userVote === index);

                            return `
                                <div style="margin-bottom: 0.75rem;">
                                    <button
                                        onclick="voteOnPoll(${poll.id}, ${index})"
                                        ${poll.hasVoted || !poll.isActive || isExpired ? 'disabled' : ''}
                                        style="
                                            width: 100%;
                                            padding: 1rem;
                                            border: 2px solid ${isUserVote ? '#10b981' : '#e2e8f0'};
                                            border-radius: var(--radius-xl);
                                            background: ${isUserVote ? '#f0fdf4' : 'white'};
                                            cursor: ${poll.hasVoted || !poll.isActive || isExpired ? 'default' : 'pointer'};
                                            text-align: left;
                                            position: relative;
                                            overflow: hidden;
                                            transition: all 0.3s ease;
                                        "
                                        ${!poll.hasVoted && poll.isActive && !isExpired ? 'onmouseover="this.style.borderColor=\'#3b82f6\'; this.style.background=\'#f0f4ff\'" onmouseout="this.style.borderColor=\'' + (isUserVote ? '#10b981' : '#e2e8f0') + '\'; this.style.background=\'' + (isUserVote ? '#f0fdf4' : 'white') + '\'"' : ''}
                                    >
                                        <div style="position: relative; z-index: 2; display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-weight: ${isUserVote ? '600' : '500'}; color: ${isUserVote ? '#059669' : '#374151'};">
                                                ${option} ${isUserVote ? '✓' : ''}
                                            </span>
                                            <span style="font-weight: 600; color: ${isUserVote ? '#059669' : '#6b7280'};">
                                                ${poll.votes[index]} votes (${percentage}%)
                                            </span>
                                        </div>
                                        ${poll.totalVotes > 0 ? `
                                            <div style="
                                                position: absolute;
                                                top: 0;
                                                left: 0;
                                                height: 100%;
                                                width: ${percentage}%;
                                                background: ${isUserVote ? '#10b981' : '#3b82f6'};
                                                opacity: 0.1;
                                                z-index: 1;
                                                transition: width 0.8s ease;
                                            "></div>
                                        ` : ''}
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div style="padding-top: 1rem; border-top: 1px solid var(--color-secondary-200); display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.875rem; font-weight: 500; color: ${poll.hasVoted ? '#059669' : poll.isActive && !isExpired ? '#3b82f6' : '#6b7280'};">
                            ${poll.hasVoted ?
                                '✅ You have voted in this poll' :
                                poll.isActive && !isExpired ?
                                    `🗳️ Click ${poll.allowMultiple ? 'options' : 'an option'} to vote` :
                                    '🔒 This poll is closed'
                            }
                        </span>
                        <div style="text-align: right;">
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">${poll.totalVotes} total votes</div>
                            ${poll.allowMultiple ? '<div style="font-size: 0.75rem; color: var(--color-secondary-500);">Multiple selections allowed</div>' : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Voting Functions
        function voteOnPoll(pollId, optionIndex) {
            const poll = polls.find(p => p.id === pollId);
            if (!poll || poll.hasVoted || !poll.isActive) return;

            const isExpired = new Date(poll.expiresAt) < new Date();
            if (isExpired) {
                showNotification('This poll has expired and is no longer accepting votes.', 'error');
                return;
            }

            if (poll.allowMultiple) {
                // Handle multiple selection polls
                if (!poll.userVote) poll.userVote = [];

                if (poll.userVote.includes(optionIndex)) {
                    // Remove vote
                    poll.userVote = poll.userVote.filter(v => v !== optionIndex);
                    poll.votes[optionIndex]--;
                    poll.totalVotes--;
                } else {
                    // Add vote
                    poll.userVote.push(optionIndex);
                    poll.votes[optionIndex]++;
                    poll.totalVotes++;
                }

                poll.hasVoted = poll.userVote.length > 0;
            } else {
                // Handle single selection polls
                poll.votes[optionIndex]++;
                poll.totalVotes++;
                poll.hasVoted = true;
                poll.userVote = optionIndex;
            }

            renderPolls();
            updateStats();
            showNotification('Vote recorded successfully!', 'success');
        }

        // Modal Functions
        function showCreatePollModal() {
            document.getElementById('createPollModal').classList.add('show');
        }

        function hideCreatePollModal() {
            document.getElementById('createPollModal').classList.remove('show');
            document.getElementById('createPollForm').reset();
            resetPollOptions();
        }

        function showPollDetails(pollId) {
            const poll = polls.find(p => p.id === pollId);
            if (!poll) return;

            const modal = document.getElementById('pollDetailsModal');
            const content = document.getElementById('pollDetailsContent');

            const totalVotes = poll.totalVotes;
            const topOption = poll.votes.indexOf(Math.max(...poll.votes));

            content.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h4 style="margin-bottom: 1rem;">${poll.question}</h4>
                    ${poll.description ? `<p style="color: var(--color-secondary-600); margin-bottom: 1rem;">${poll.description}</p>` : ''}

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="text-align: center; padding: 1rem; background: var(--color-primary-50); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary-600);">${totalVotes}</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Total Votes</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: var(--color-secondary-50); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-secondary-600);">${poll.options.length}</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Options</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #059669;">${totalVotes > 0 ? Math.round((poll.votes[topOption] / totalVotes) * 100) : 0}%</div>
                            <div style="font-size: 0.875rem; color: var(--color-secondary-600);">Top Choice</div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h5 style="margin-bottom: 1rem;">Detailed Results</h5>
                    ${poll.options.map((option, index) => {
                        const percentage = totalVotes > 0 ? Math.round((poll.votes[index] / totalVotes) * 100) : 0;
                        return `
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="font-weight: 500;">${option}</span>
                                    <span style="color: var(--color-secondary-600);">${poll.votes[index]} votes (${percentage}%)</span>
                                </div>
                                <div style="width: 100%; height: 8px; background: var(--color-secondary-200); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${percentage}%; height: 100%; background: var(--color-primary-500); transition: width 0.8s ease;"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="padding-top: 1rem; border-top: 1px solid var(--color-secondary-200);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="font-weight: 500;">Poll Status:</span>
                        <span style="padding: 0.25rem 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 500; ${poll.isActive ? 'background: #dcfce7; color: #166534;' : 'background: #fee2e2; color: #991b1b;'}">
                            ${poll.isActive ? 'Active' : 'Closed'}
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="font-weight: 500;">Created:</span>
                        <span style="color: var(--color-secondary-600);">${poll.createdAt} by ${poll.createdBy}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 500;">Expires:</span>
                        <span style="color: var(--color-secondary-600);">${poll.expiresAt}</span>
                    </div>
                </div>
            `;

            modal.classList.add('show');
        }

        function hidePollDetailsModal() {
            document.getElementById('pollDetailsModal').classList.remove('show');
        }

        // Poll Management Functions
        function togglePollStatus(pollId) {
            const poll = polls.find(p => p.id === pollId);
            if (!poll) return;

            poll.isActive = !poll.isActive;
            renderPolls();
            updateStats();
            showNotification(`Poll ${poll.isActive ? 'activated' : 'deactivated'} successfully!`, 'success');
        }

        function deletePoll(pollId) {
            if (!confirm('Are you sure you want to delete this poll? This action cannot be undone.')) return;

            const pollIndex = polls.findIndex(p => p.id === pollId);
            if (pollIndex === -1) return;

            polls.splice(pollIndex, 1);
            renderPolls();
            updateStats();
            showNotification('Poll deleted successfully!', 'success');
        }

        // Poll Creation Functions
        function addPollOption() {
            const optionsContainer = document.getElementById('pollOptions');
            const optionCount = optionsContainer.children.length + 1;

            if (optionCount > 10) {
                showNotification('Maximum 10 options allowed per poll.', 'error');
                return;
            }

            const optionDiv = document.createElement('div');
            optionDiv.style.cssText = 'display: flex; gap: 0.5rem; margin-bottom: 0.5rem;';
            optionDiv.innerHTML = `
                <input type="text" class="poll-option-input" required placeholder="Option ${optionCount}"
                       style="flex: 1; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                <button type="button" onclick="removePollOption(this)" class="btn btn-danger" style="padding: 0.75rem;">🗑️</button>
            `;

            optionsContainer.appendChild(optionDiv);
        }

        function removePollOption(button) {
            const optionsContainer = document.getElementById('pollOptions');
            if (optionsContainer.children.length <= 2) {
                showNotification('Minimum 2 options required for a poll.', 'error');
                return;
            }

            button.parentElement.remove();
        }

        function resetPollOptions() {
            const optionsContainer = document.getElementById('pollOptions');
            optionsContainer.innerHTML = `
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="poll-option-input" required placeholder="Option 1"
                           style="flex: 1; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                    <button type="button" onclick="removePollOption(this)" class="btn btn-danger" style="padding: 0.75rem;">🗑️</button>
                </div>
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="poll-option-input" required placeholder="Option 2"
                           style="flex: 1; padding: 0.75rem; border: 2px solid var(--color-secondary-200); border-radius: var(--radius-lg); font-size: 1rem;">
                    <button type="button" onclick="removePollOption(this)" class="btn btn-danger" style="padding: 0.75rem;">🗑️</button>
                </div>
            `;
        }

        // Form Submission
        document.getElementById('createPollForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const question = document.getElementById('pollQuestion').value.trim();
            const description = document.getElementById('pollDescription').value.trim();
            const category = document.getElementById('pollCategory').value;
            const duration = parseInt(document.getElementById('pollDuration').value);
            const allowMultiple = document.getElementById('allowMultiple').checked;

            const optionInputs = document.querySelectorAll('.poll-option-input');
            const options = Array.from(optionInputs).map(input => input.value.trim()).filter(option => option);

            if (options.length < 2) {
                showNotification('Please provide at least 2 options for the poll.', 'error');
                return;
            }

            // Check for duplicate options
            const uniqueOptions = [...new Set(options)];
            if (uniqueOptions.length !== options.length) {
                showNotification('Please ensure all options are unique.', 'error');
                return;
            }

            // Create new poll
            const newPoll = {
                id: Math.max(...polls.map(p => p.id)) + 1,
                question: question,
                description: description,
                options: options,
                votes: new Array(options.length).fill(0),
                totalVotes: 0,
                category: category,
                createdBy: 'Admin',
                createdAt: new Date().toISOString().split('T')[0],
                expiresAt: new Date(Date.now() + duration * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                isActive: true,
                hasVoted: false,
                allowMultiple: allowMultiple,
                userVote: null
            };

            polls.unshift(newPoll);
            hideCreatePollModal();
            renderPolls();
            updateStats();
            showNotification('Poll created successfully!', 'success');
        });

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
    </script>
    <script src="js/navigation.js"></script>
</body>
</html>
